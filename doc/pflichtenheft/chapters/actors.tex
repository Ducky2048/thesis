\chapter{Actors}
\label{ch:actors}

Actors specify a role played by a user or a system for the purposes of a clearer definition.
In this chapter, we will outline the actors in our system.

\begin{landscape}
	\section{Big Picture}
%	\topskip0pt
	\begin{figure}[H]
		\begin{center}
			\includegraphics[scale=0.55]{images/BigPicture.png}
			\caption{Big Picture}
			\label{fig:bigpicture}
		\end{center}
	\end{figure}
\end{landscape}

\subsection{Registration}
\begin{enumerate}
	\item Registration of identity with \gls{RA} (Authenticator)
	
	A Pre-requisite for using our signing service is that the user(Verifier) is registered with an \gls{IDP}.
	The user registers at the \gls{RA} which proves its identity.
	
	\item Propagate identity to \gls{IDP} (Identifier)
	
	After the identity has been registered, the \gls{RA} propagates it to the \gls{IDP}.
	The \gls{RA} and \gls{IDP} may be the same entity.
\end{enumerate}

\subsection{Identification}
\begin{enumerate}[resume]
	\item Generate document hash
	
	The user(Verifier) generates the hashes of the document(s) it wishes to sign.
	This is needed before the identification step in order to prevent signing of arbitrary documents.
	
	\item Send hash to signing service
	
	The sends the hashes to the signing service.
	
	\item Receive \gls{OIDC} redirect to \gls{IDP}
	
	The signing service computes a nonce from the hashes and a random value which will be used as the nonce in the \gls{OIDC} request.
	Then it sends the redirect to the \gls{IDP} to the user.
	
	\item Login to \gls{IDP}
	
	The user follows the redirect and logs in to the \gls{IDP} in order to confirm its identity.
	
	\item Receive ID token
	
	After successful login the user receives an ID token from the \gls{IDP} which will contain the nonce in addition to the identity information.
	
	\item Send ID token to signing service
	
	The user sends the ID token to the signing service.
	
	\item Verify ID token
	
	The signing service validates the ID token (\gls{JWT}) and checks if the nonce matches too.
\end{enumerate}

	
\subsection{Signature Generation}
\begin{enumerate}[resume]
	\item Request signing key \gls{CSR} from \gls{HSM}
	
	The signing service requests a new key to be generated from the \gls{HSM}.
	
	\item Receive \gls{CSR}
	
	The HSM generates a new key and returns the \gls{CSR}.
	
	\item Send \gls{CSR} to \gls{CA}
	
	The signing service sends the \gls{CSR} to the \gls{CA} in order to be signed.
	
	\item Receive signed Certificate
	
	The \gls{CA} signs the \gls{CSR} and returns the signed certificate.
	
	\item Request signature from \gls{HSM}
	
	The signing service sends the hash to the \gls{HSM} in order to be signed.
	
	\item Receive signature
	
	The \gls{HSM} sends the signed hash to the signing service.
	
	\item Request timestamp from \gls{TSS}
	
	The signing service sends the signature of the hash to the \gls{TSS}.
	
	\item Receive timestamp
	
	The \gls{TSS} adds a timestamp to the signature and signs it.

	\item Send signature to signer
	
	The signing service constructs the final signature containing the signed hash, the timestamp, the ID token and the chains of all used certificates to the user.
\end{enumerate}
	
\subsection{Signature Verification}
\begin{enumerate}[resume]
	\item Send document and signature to receiver(Verifier)
	
	The user sends the document and the signature to the intended receiver.
	
	\item Verify document and signature
	
	The receiver uses the validation tool to validate the document and signature.
\end{enumerate}

\section{The Signer}
\label{sec:actorsigner}
The Signer is the person who wishes to have the signing server sign a document in their name.
For example, a medical professional issuing a prescription for medication to a patient.

\section{The Verifier}
\label{sec:actorverifier}
The Verifier is the person who wishes to verify the integrity and authorship of a document.
For example, the pharmacist whom the patient gives the prescription to (as previously authored and signed by The Signer as specified in section~\ref{sec:actorsigner}) in order to purchase the medication prescribed by the medical professional.

\section{The Authenticator}
\label{sec:actorauthenticator}
The Authenticator is the system who authenticates The Signer as specified in section~\ref{sec:actorsigner}.
In \gls{NIST} terminology~\cite{nistdigitalidentityguidelines}, this is the entity establishing the \gls{IAL}.
In order for The Authenticator to be able to authenticate The Signer,
they must have been registered with The Authenticator by The Identifier as specified in section~\ref{sec:authoridentifier}.

\section{The Identifier}
\label{sec:authoridentifier}
The Identifier is the system or person who asserts the identity of The Signer.
In order for the signing service to issue qualified signatures as defined by relevant Swiss legislation~\cite{zertes} and Swiss Federal Council regulations~\cite{vzertes},
the identity must be proven in-person using a government-issued photographic identification document such as a passport.

\section{The Signing Service}
\label{sec:actorsigningservice}
The Signing Service is the system who actually creates the signatures on behalf of the user.
It generates the signing keys and requests the \gls{CA}~\ref{sec:ca} to sign them.

\section{The Certificate Authority}
\label{sec:actorca}
The \gls{CA} is the system who signs the signing keys generated by the Signing Service~\ref{sec:signingservice}.
